<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My CVs - CVBuilder</title>
    <link rel="stylesheet" th:href="@{/css/livecareer.css}">
</head>
<body>
<nav class="nav">
    <div class="brand">CVBuilder ‚ú®</div>
    <div class="links">
        <a href="/my-cvs">My CVs</a>
        <a href="/create-cv-ai">Create CV (AI)</a>
        <a href="/login" onclick="localStorage.removeItem('token')">Logout</a>
    </div>
</nav>

<div class="shell">
    <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
        <div>
            <h2 style="margin:0;">Danh s√°ch CV c·ªßa b·∫°n</h2>
            <div class="muted">Qu·∫£n l√Ω v√† t·∫£i xu·ªëng CV d·ªÖ d√†ng</div>
        </div>
        <div>
            <a class="btn ok" href="/create-cv-ai">+ T·∫°o CV m·ªõi</a>
        </div>
    </div>

    <div class="shell" style="padding:0;">
        <div id="cv-grid" class="cv-grid"></div>
    </div>
</div>

<script>
    const token = localStorage.getItem('token');
    if (!token) { alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p.'); window.location.href = '/login'; }

    async function loadMyCVs() {
        const res = await fetch('/api/cv/my-cvs', { headers: { 'Accept':'application/json', 'Authorization': 'Bearer ' + token }});
        if (!res.ok) { alert('Kh√¥ng t·∫£i ƒë∆∞·ª£c danh s√°ch CV'); return; }
        const list = await res.json();
        const grid = document.getElementById('cv-grid');
        grid.innerHTML = '';

        if (!list.length) {
            grid.innerHTML = '<div class="card">B·∫°n ch∆∞a c√≥ CV n√†o. H√£y t·∫°o CV ƒë·∫ßu ti√™n!</div>';
            return;
        }

        list.forEach(cv => {
            const card = document.createElement('div');
            card.className = 'cv-card';
            card.innerHTML = `
        <h3>${cv.fullName ?? ''}</h3>
        <div class="muted">${cv.jobTitle ?? ''}</div>
        <div class="hr"></div>
        <div><strong>Email:</strong> ${cv.email ?? ''}</div>
        <div class="cv-actions">
          <a class="btn gho" href="/create-cv-ai?edit=${cv.id}">üìù S·ª≠a</a>
          <button class="btn outline-danger" data-del="${cv.id}">üóë Xo√°</button>
          <a class="btn pri" href="/api/cv/${cv.id}/export">üìÑ T·∫£i PDF</a>
        </div>
      `;
            grid.appendChild(card);
        });

        grid.querySelectorAll('[data-del]').forEach(btn => {
            btn.addEventListener('click', async () => {
                const id = btn.getAttribute('data-del');
                if (!confirm('Xo√° CV n√†y?')) return;
                const delRes = await fetch('/api/cv/' + id, { method:'DELETE', headers: { 'Authorization':'Bearer ' + token }});
                if (delRes.ok) {
                    btn.closest('.cv-card').remove();
                } else {
                    alert('Xo√° th·∫•t b·∫°i');
                }
            });
        });
    }

    loadMyCVs();
</script>
</body>
</html>
